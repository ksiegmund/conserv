---
title: "Format nci-60 DNAm datasets"
author: "K Siegmund"
date: "4/27/2021"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```
# {.tabset}

## Spain

Download the NCI-60 DNA methylation data in GSE49143 (Spain, 2013) and GSE79185 (USA, 2016).  The second data set was published in PMID: 27923837. 

```{r libraries}
library(purrr)
if(!require("GEOquery")) {BiocManager::install("GEOquery")}
library(GEOquery)
library(limma)
```

```{r load-data-spain}
gse49143<-getGEO('GSE49143',GSEMatrix=TRUE)

#load("data/JBC 2012/gse31873.rda")
```

```{r showgse}
show(gse49143)
```

We want to organize the data into a list object, spain, with three matrices:    
* beta for the DNA methylation data  (exprs)  
* targets for sample annotation  (pData)  
* genes for gene annotation  (fData)  
```{r exprs}
gse <- gse49143$GSE49143_series_matrix.txt.gz
dnamspain <- NULL
dnamspain$beta <- exprs(gse)    
dnamspain$beta[1:4,1:3] 
```

pData accesses the sample annotation information (p stands for phenotype.)

```{r pDannot}
names(pData(gse))   
```

Grab the cell line name and the tissue type.
```{r annot}
pData(gse)$'cell line:ch1'        # cell line
pData(gse)$'tissue:ch1'           # tissue
```

Now I will create a sample annotation dataframe named targets. 
```{r sampannot}
pdat <- data.frame(title = pData(gse)$'cell line:ch1',
                   tissue = pData(gse)$'tissue:ch1' )
rownames(pdat) <- pData(gse)$geo_accession
dnamspain$targets <- pdat[colnames(dnamspain$beta),]
rm(pdat)
```

Show that the annotation data and DNAm data are ordered identically.
```{r checkorder}
identical(as.character(rownames(dnamspain$targets)),
                colnames(dnamspain$beta))
```

fData is the feature (gene) annotation data.

```{r fDannot}
names(fData(gse))   
```

Now let's save some array feature annotation information. 
```{r featannot}
dnamspain$hm450annot <- data.frame(fData(gse))
table(substr(rownames(dnamspain$hm450annot),1,2))
```

```{r dataobj}
names(dnamspain)
```

Let's save this data set for future use.
```{r savedata}
save(dnamspain,file = file.path("data","dnamspain.rda"))
```


## USA

Now let's read in the data from USA.

```{r load-gsedata-usa}
gse79185<-getGEO('GSE79185',GSEMatrix=TRUE)
```

```{r showgse}
show(gse79185)
```

We want to organize the data into a list object, spain, with three matrices:    
* beta for the DNA methylation data  (exprs)  
* targets for sample annotation  (pData)  
* genes for gene annotation  (fData)  
```{r exprs}
gse <- gse79185$GSE79185_series_matrix.txt.gz
dnamusa <- NULL
dnamusa$beta <- exprs(gse)    
dnamusa$beta[1:4,1:3] 
```

pData accesses the sample annotation information (p stands for phenotype.)

```{r pDannot}
names(pData(gse))   
```

Grab the cell line name and the tissue type.
```{r annot}
pData(gse)$'cell line:ch1'        # cell line
pData(gse)$'tissue:ch1'           # tissue
```

Now I will create a sample annotation dataframe named targets. 
```{r sampannot}
pdat <- data.frame(title = pData(gse)$'cell line:ch1',
                   tissue = pData(gse)$'tissue:ch1' )
rownames(pdat) <- pData(gse)$geo_accession
dnamusa$targets <- pdat[colnames(dnamusa$beta),]
rm(pdat)
```

Show that the annotation data and DNAm data are ordered identically.
```{r checkorder}
identical(as.character(rownames(dnamusa$targets)),
                colnames(dnamusa$beta))
```

fData is the feature (gene) annotation data.

```{r fDannot}
names(fData(gse))   
```

It's a bit redundant to save this twice, but I will for now.
```{r featannot}
dnamusa$hm450annot <- data.frame(fData(gse))
table(substr(rownames(dnamusa$hm450annot),1,2))
```

ugh. They dropped the rs features.

```{r dataobj}
names(dnamusa)
```

Let's save this data set for future use.
```{r savedata}
save(dnamusa,file = file.path("data","dnamusa.rda"))
```

Why are there 61 samples in the USA data set?


```{r sessionInfo}
sessionInfo()
```

